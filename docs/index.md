---
marp: true
title: Нагружаем банки
description: Как ускорить запросы к InfluxDB с помощью InfluxQL Continuous Queries и разделения данных 
theme: vtb_tks
template: bespoke
paginate: true
_paginate: false

---

<!-- _class: lead12
-->

# Нагружаем банки<br>Смирнов Вячеслав<br>Рогожников Максим

## __Москва, 2021__

<!--

-->

---
<!-- _class: main
-->

# О технологиях и подходах реализации нагрузки в двух разных командах

<!-- 
Чуть более конкретные примеры.
Провести тестирование Heisenbug в Firefox. 
Максим, ваш выход ))

Не словами а конкретикой

2) Не очень понятно, что делать с записью?
Если запись не делать, 
то каждый может высказываться на любую тему.

Непотребство из записи будет убрано

Раписание - выйти в эфир в формате Главной студии, 
круглый стол по производительности
6 октября, начинается за 15 минут до конца доклада, 
30 минут перерыва
15 минут после начала следующего доклада
-->

---

<!-- _class: title-->

# Тестирую и ускоряю ДБО для юридических лиц в банке ВТБ
## __Развиваю @qa_load__

![bg cover](img/omsk.jpg)

<!-- 
Повышаю качество более десяти лет. Занимаюсь системой дистанционного банковского обслуживания юридических лиц. Основной профиль моей работы — тестирование производительности. Развиваю сообщество инженеров по тестированию производительности, помогая коллегам в telegram чате «QA — Load & Performance».
-->

---


<!-- _class: title_tks -->

# Тестирую и ускоряю системы в Тинькофф
## __Развиваю @qa_load__

![bg cover](img/Maks.jpg)

<!-- 

-->

---
<!-- _class: main -->

* Планирование
* Профиль нагрузки
* Инструменты
* Тестовый стенд
* Тестовые данные
* Тестирование на продуктиве
* Виды тестов
* CI/CD для нагрузки
* Мониторинг
* Логи
* Отчеты
* Кто делает запуски тестов
* Кто поддерживает тесты


---
<!-- _class: main
-->

# Планирование

---
<!-- _class: head_tks
-->
# Канбан

## __Стандартные проекты НТ__

## __Поддержка и развитие инфраструктуры__

## __Разработка инструментов НТ__

Приоритетное направление

**_![ opacity:40% ](themes/img/tks2.png)_**

---
<!-- class: head2 -->
# Скрам

## __Регулярные тесты__

## __Поддержка инфраструктуры и стендов__
## __Разработка инструментов анализа__
Мониторинг, анализ, отчет
## __Замеры__
## __Профилирование__



**_![ opacity:20% ](themes/img/lead/lead04.png)_**

---
<!-- _class: compare
-->

- Сервисная команда проекта
- Скрам
- Разработка инструментов анализа
- Поддержка стендов
- Регулярные тесты
- Замеры
- Профилирование

1. Сервисная команда компании
1. Канбан
1. Разработка инструментов НТ
1. Поддержка инфраструктуры
1. Стандартные проекты НТ


---
<!-- _class: main
-->

# Профиль нагрузки

---

<!-- class: head2 -->

# Прогноз профиля, но точный SLA

## __Состав операций с легаси__ 

Но с учетом новых операций

## __Интенсивность с легаси__

Но с учетом прогноза роста

## __SLA c продуктива__

С ненагруженной системы



**_![ opacity:20%  ](themes/img/lead/lead04.png)_**

---
<!-- _class: head_tks
-->
# Автосбор профиля по RED либо по логам

## __Соответствие профиля продуктиву__

Минимум на 95%

## __Соответствие интенсивности продуктиву__

На 100%

## __Требуем от команд SLA и NFR__

Без этого не начинаем

**_![ opacity:40% ](themes/img/tks2.png)_**

---
<!-- _class: compare2
-->

- Для системы в процессе миграции
- Прогноз профиля
- Соответствие профиля легаси
- Соответствие интенсивности легаси + прогноз роста интенсивности
- Посчитали SLA с продуктива

1. Для систем, которые уже в проде
1. Автосбор профиля
1. Соответствие профиля продуктиву
1. Соответствие интенсивности продуктиву
1. Требуем от команд SLA


---
<!-- _class: main
-->

# Инструменты

---

# Maven, JMeter Maven Plugin, JMeter и его плагины

## __Работа по инцидентам: Skype + коллега__

Самые горячие проблемы 

## __Firefox, Fiddler, JVM-профайлер__

Для проработки узких мест

## __Регулярные тесты: Apache.JMeter__

Для регресса

**_![ opacity:40%  ](themes/img/lead/lead04.png)_**

---
<!-- _class: head_tks
-->
# SBT, Gatling + свои плагины, Scala, K6, GoLang

## __Единообразный процесс запуска НТ__

## __Вне зависимости от инструмента__

## __Не важно что генерирует нагрузку__

Вы всегда получите
один и тот же результат 
и набор графиков

**_![ opacity:40% ](themes/img/tks.png)_**


---
<!-- _class: compare2
-->

- Maven, JMeter Maven Plugin, JMeter
- плагины JMeter
- Perfomance Center, Gatling
- Профиль нагрузки и SLA задается в property-файле
- Много профилирования и настройки

1. SBT, Gatling, Scala
1. свои плагины Gatling
1. K6, GoLang
1. Профиль нагрузки и SLA задается в yaml-файле
1. Единообразный процесс запуска НТ

---
<!-- _class: main
-->

# Тестовый стенд

---

# Фиксированные стенды, одно плечо продуктива

##

**_![ opacity:40%  ](themes/img/lead/lead04.png)_**

---
<!-- _class: head_tks
-->
# Отдельные NS в k8s или переиспользуем стенд

## __Системы объединены по направлению__
И у них должны быть 
одинаковые потребности 
по ресурсам

## __Стараемся делать 1 плечо прода__

1 датацентр либо 
1 плечо нагрузки 

**_![ opacity:40% ](themes/img/tks.png)_**

---
<!-- _class: main
-->

# Тестовые данные

---
<!-- _class: main
-->

# Тестирование на продуктиве

---
<!-- _class: main
-->

# Виды тестов

---
<!-- _class: main
-->

# CI/CD для нагрузки

---
<!-- _class: main
-->

# Мониторинг

---
<!-- _class: main
-->

# Логи

---
<!-- _class: main
-->

# Отчеты

---
<!-- _class: main
-->

# Кто делает запуски тестов

---
<!-- _class: main
-->

# Кто поддерживает тесты


---
<!-- _class: main
-->

# Итоги


---

<!-- _class: lead12
-->

# Вопросы/ответы<br> Нагружаем банки<br>ВТБ, Тинькофф

## __Вячеслав, Максим, @qa_load__



